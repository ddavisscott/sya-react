{"ast":null,"code":"\"use strict\";\n/*\n * Copyright 2017-2018 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = Object.setPrototypeOf || {\n    __proto__: []\n  } instanceof Array && function (d, b) {\n    d.__proto__ = b;\n  } || function (d, b) {\n    for (var p in b) {\n      if (b.hasOwnProperty(p)) d[p] = b[p];\n    }\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar React = require(\"react\");\n\nvar react_1 = require(\"react\");\n\nvar core_1 = require(\"@aws-amplify/core\");\n\nvar auth_1 = require(\"@aws-amplify/auth\");\n\nvar Greetings_1 = require(\"./Greetings\");\n\nvar SignIn_1 = require(\"./SignIn\");\n\nvar ConfirmSignIn_1 = require(\"./ConfirmSignIn\");\n\nvar RequireNewPassword_1 = require(\"./RequireNewPassword\");\n\nvar SignUp_1 = require(\"./SignUp\");\n\nvar ConfirmSignUp_1 = require(\"./ConfirmSignUp\");\n\nvar VerifyContact_1 = require(\"./VerifyContact\");\n\nvar ForgotPassword_1 = require(\"./ForgotPassword\");\n\nvar TOTPSetup_1 = require(\"./TOTPSetup\");\n\nvar Amplify_UI_Theme_1 = require(\"../Amplify-UI/Amplify-UI-Theme\");\n\nvar AmplifyMessageMap_1 = require(\"../AmplifyMessageMap\");\n\nvar Amplify_UI_Components_React_1 = require(\"../Amplify-UI/Amplify-UI-Components-React\");\n\nvar logger = new core_1.ConsoleLogger('Authenticator');\n\nvar Authenticator =\n/** @class */\nfunction (_super) {\n  __extends(Authenticator, _super);\n\n  function Authenticator(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this.handleStateChange = _this.handleStateChange.bind(_this);\n    _this.handleAuthEvent = _this.handleAuthEvent.bind(_this);\n    _this.onHubCapsule = _this.onHubCapsule.bind(_this);\n    _this._initialAuthState = _this.props.authState || 'signIn';\n    _this.state = {\n      auth: 'loading'\n    };\n    core_1.Hub.listen('auth', _this);\n    return _this;\n  }\n\n  Authenticator.prototype.componentDidMount = function () {\n    var config = this.props.amplifyConfig;\n\n    if (config) {\n      core_1.default.configure(config);\n    }\n\n    this._isMounted = true;\n    this.checkUser();\n  };\n\n  Authenticator.prototype.componentWillUnmount = function () {\n    this._isMounted = false;\n  };\n\n  Authenticator.prototype.checkUser = function () {\n    var _this = this;\n\n    var auth = this.state.auth;\n\n    if (!auth_1.default || typeof auth_1.default.currentAuthenticatedUser !== 'function') {\n      throw new Error('No Auth module found, please ensure @aws-amplify/auth is imported');\n    }\n\n    return auth_1.default.currentAuthenticatedUser().then(function (user) {\n      if (!_this._isMounted) {\n        return;\n      }\n\n      if (auth !== 'signedIn') {\n        _this.setState({\n          authState: 'signedIn',\n          authData: user\n        });\n\n        _this.handleStateChange('signedIn', user);\n      }\n    }).catch(function (err) {\n      if (!_this._isMounted) {\n        return;\n      }\n\n      auth_1.default.signOut().then(function () {\n        return _this.handleStateChange(_this._initialAuthState);\n      });\n    });\n  };\n\n  Authenticator.prototype.onHubCapsule = function (capsule) {\n    var channel = capsule.channel,\n        payload = capsule.payload,\n        source = capsule.source;\n\n    if (channel === 'auth' && (payload.event === 'configured' || payload.event === 'cognitoHostedUI')) {\n      this.checkUser();\n    }\n  };\n\n  Authenticator.prototype.handleStateChange = function (state, data) {\n    logger.debug('authenticator state change ' + state, data);\n\n    if (state === this.state.auth) {\n      return;\n    }\n\n    if (state === 'signedOut') {\n      state = 'signIn';\n    }\n\n    this.setState({\n      auth: state,\n      authData: data,\n      error: null,\n      showToast: false\n    });\n\n    if (this.props.onStateChange) {\n      this.props.onStateChange(state, data);\n    }\n  };\n\n  Authenticator.prototype.handleAuthEvent = function (state, event, showToast) {\n    if (showToast === void 0) {\n      showToast = true;\n    }\n\n    if (event.type === 'error') {\n      var map = this.props.errorMessage || AmplifyMessageMap_1.default;\n      var message = typeof map === 'string' ? map : map(event.data);\n      this.setState({\n        error: message,\n        showToast: showToast\n      });\n    }\n  };\n\n  Authenticator.prototype.render = function () {\n    var _this = this;\n\n    var _a = this.state,\n        auth = _a.auth,\n        authData = _a.authData;\n    var theme = this.props.theme || Amplify_UI_Theme_1.default;\n    var messageMap = this.props.errorMessage || AmplifyMessageMap_1.default;\n    var _b = this.props,\n        hideDefault = _b.hideDefault,\n        _c = _b.hide,\n        hide = _c === void 0 ? [] : _c,\n        federated = _b.federated;\n\n    if (hideDefault) {\n      hide = hide.concat([Greetings_1.default, SignIn_1.default, ConfirmSignIn_1.default, RequireNewPassword_1.default, SignUp_1.default, ConfirmSignUp_1.default, VerifyContact_1.default, ForgotPassword_1.default, TOTPSetup_1.default]);\n    }\n\n    var props_children = this.props.children || [];\n    var default_children = [React.createElement(Greetings_1.default, {\n      federated: federated\n    }), React.createElement(SignIn_1.default, {\n      federated: federated\n    }), React.createElement(ConfirmSignIn_1.default, null), React.createElement(RequireNewPassword_1.default, null), React.createElement(SignUp_1.default, null), React.createElement(ConfirmSignUp_1.default, null), React.createElement(VerifyContact_1.default, null), React.createElement(ForgotPassword_1.default, null), React.createElement(TOTPSetup_1.default, null)];\n    var props_children_names = React.Children.map(props_children, function (child) {\n      return child.type.name;\n    });\n    var props_children_override = React.Children.map(props_children, function (child) {\n      return child.props.override;\n    });\n    hide = hide.filter(function (component) {\n      return !props_children_names.includes(component.name);\n    });\n    var hideLink = hide.filter(function (component) {\n      return !props_children_override.some(function (comp) {\n        return comp === component;\n      });\n    });\n    var render_props_children = React.Children.map(props_children, function (child, index) {\n      return React.cloneElement(child, {\n        key: 'aws-amplify-authenticator-props-children-' + index,\n        theme: theme,\n        messageMap: messageMap,\n        authState: auth,\n        authData: authData,\n        onStateChange: _this.handleStateChange,\n        onAuthEvent: _this.handleAuthEvent,\n        hide: hide,\n        hideLink: hideLink\n      });\n    });\n    var render_default_children = hideDefault ? [] : React.Children.map(default_children, function (child, index) {\n      return React.cloneElement(child, {\n        key: 'aws-amplify-authenticator-default-children-' + index,\n        theme: theme,\n        messageMap: messageMap,\n        authState: auth,\n        authData: authData,\n        onStateChange: _this.handleStateChange,\n        onAuthEvent: _this.handleAuthEvent,\n        hide: hide,\n        hideLink: hideLink\n      });\n    });\n    var render_children = render_default_children.concat(render_props_children);\n    var error = this.state.error;\n    return React.createElement(Amplify_UI_Components_React_1.Container, {\n      theme: theme\n    }, this.state.showToast && React.createElement(Amplify_UI_Components_React_1.Toast, {\n      theme: theme,\n      onClose: function onClose() {\n        return _this.setState({\n          showToast: false\n        });\n      }\n    }, core_1.I18n.get(error)), render_children);\n  };\n\n  return Authenticator;\n}(react_1.Component);\n\nexports.default = Authenticator;","map":null,"metadata":{},"sourceType":"script"}